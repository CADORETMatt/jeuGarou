<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Mini JDR - ChatGPT MJ</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #111;
            color: #eee;
            padding: 20px;
        }

        #chat {
            max-width: 800px;
            margin: auto;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 12px;
            background: #222;
        }

        .msg {
            margin: 8px 0;
            padding: 10px;
            border-radius: 8px;
        }

        .user {
            background: #004d40;
        }

        .mj {
            background: #283593;
        }

        .npc {
            background: #4a148c;
        }

        textarea {
            width: 100%;
            height: 70px;
            margin-top: 10px;
        }

        button {
            margin-top: 10px;
            padding: 8px 16px;
            background: #00897b;
            color: #fff;
            border: none;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <div id="chat">
        <h2>üßô Mini JDR - MJ IA (GPT)</h2>
        <input type="password" id="apiKey" placeholder="Cl√© API OpenAI..." style="width:100%;padding:8px;">
        <div id="messages"></div>
        <textarea id="userInput" placeholder="Que fait ton personnage ?"></textarea>
        <button onclick="sendMessage()">Envoyer</button>
    </div>

    <script>
        const messagesDiv = document.getElementById('messages');
        const systemPrompt = `
      Tu es un Ma√Ætre du Jeu de Donjons et Dragons.
      D√©cris les sc√®nes de mani√®re immersive et fais interagir le joueur avec des PNJ.
      Il y a deux PNJ compagnons : Lyria (elfe mage prudente) et Bragor (barbare impulsif).
      Laisse parfois ces PNJ parler ou r√©agir.
      Le joueur contr√¥le un aventurier libre, tu g√®res tout le reste.
    `;

        let chatHistory = [{ role: "system", content: systemPrompt }];

        async function sendMessage() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const userText = document.getElementById('userInput').value.trim();
            if (!apiKey) return alert("Entre ta cl√© API OpenAI d'abord !");
            if (!userText) return;

            addMessage("user", userText);
            document.getElementById('userInput').value = "";

            chatHistory.push({ role: "user", content: userText });

            const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "gpt-4o-mini",
                    messages: chatHistory,
                    temperature: 0.9
                })
            });

            const data = await response.json();
            const reply = data.choices?.[0]?.message?.content || "Erreur de r√©ponse du MJ.";

            addMessage("mj", reply);
            chatHistory.push({ role: "assistant", content: reply });
        }

        function addMessage(role, text) {
            const div = document.createElement("div");
            div.className = "msg " + (role === "user" ? "user" : role === "mj" ? "mj" : "npc");
            div.innerHTML = `<b>${role === "user" ? "üßù Toi" : "üßô MJ"} :</b> ${text}`;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>

</html>