<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tralala - Jeu Garou Mortel</title>
    <style>
        :root {
            --background-color: #222;
            --background-secondary: #000;
            --text-color: #d9bfff;
            --primary-color: #470684;
            --accent-color: #FF06B5;
            --box-shadow-color: #FF06B5;
            --border-color: #ff06b5;
            --input-bg: #1c1c1c;
            --button-hover-bg: #ff06b5;
            --sidebar-bg: #470684;
            --log-bg: #000;
            --footer-color: #aaa;
            --buzz-inactive-opacity: 0.4;
            --buzz-glow: rgba(255, 0, 0, 0.6);
            --border-radius: 12px;
            --padding: 16px;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
        }

        button {
            background-color: var(--primary-color);
            color: var(--text-color);
            border: solid 2px var(--accent-color);
            padding: 5px 15px;
            padding-left: 5px;
            padding-right: 5px;
            margin: 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
        }

        button:hover {
            background-color: var(--button-hover-bg);
        }
    </style>
</head>

<body>
    <style>
        h2 {
            margin: 0;
            font-size: 16px;
        }

        #modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: block;
            z-index: 100;
        }

        #newPartie-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-color);
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            display: block;
            z-index: 101;
            box-shadow: 0 10px 25px var(--box-shadow-color);
        }

        .player-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        #newPartie-modal input

        /*[type="text"]*/
            {
            width: 65%;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        #cancel-abandon {
            display: none;
        }
    </style>
    <div id="modal-overlay"></div>
    <div id="newPartie-modal">
        <h2>Initier <br>une nouvelle partie ?</h2>
        <button id="load-partie">üìÇ Ouvrir une partie</button>
        <input type="file" id="load-file" accept="application/json" style="display:none">
        <div class="player-line">
            <input type="text" placeholder="Auto ou √©crire lieu, situation" adn-lieu="lieu">
        </div>
        <div class="player-line">
            <input type="text" placeholder="Auto ou √©crire lieu public" adn-public="sallePublic">
        </div>
        <div class="player-line">
            <input type="text" placeholder="Auto ou √©crire nom J1" value="Toi" adn-player="J1">
        </div>
        <div class="player-line">
            <input type="text" placeholder="Auto ou √©crire nom J2" adn-player="J2">
            <label>
                <input type="checkbox" adn-gpt="gpt" checked> ChatBot
            </label>
        </div>

        <div class="player-line">
            <input type="text" placeholder="Auto ou √©crire nom J3" adn-player="J3">
            <label>
                <input type="checkbox" adn-gpt="gpt" checked> ChatBot
            </label>
        </div>
        <div class="modal-actions">
            <button id="start-game">G√©n√©rer Partie</button>
            <button id="cancel-abandon">Annuler</button>
        </div>
    </div>
    <script>/////////////ADN///////////////////////
        const startAdn = {
            lieu: "",
            sallePublic: "",
            players: {
                J1: { sallePerso: "", scene: "", nom: "", role: "", perso: "", vivant: true, type: "Humain" },
                J2: { sallePerso: "", scene: "", nom: "", role: "", perso: "", vivant: true, type: "gpt" },
                J3: { sallePerso: "", scene: "", nom: "", role: "", perso: "", vivant: true, type: "gpt" }
            },
            currentSalle: "sallePublic",
            buzzActive: false
        }
        let user1is = 'J1'; // D√©finition globale pour le joueur local

        ////////Overlay//////////////////////////////////////
        const overlay = document.getElementById('modal-overlay');
        const modal = document.getElementById('newPartie-modal');
        ///////////OUVRIR //////////////////////////////
        document.getElementById('load-partie').addEventListener('click', () => {
            document.getElementById('load-file').click();
        });

        document.getElementById('load-file').addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const loaded = JSON.parse(reader.result);
                    partie = loaded;

                    updateCardPlayer();
                    //updateSalle();
                    //updateMJAdnView();
                    //showMessages();
                } catch {
                    // alert('Charg√© mais fichier JSON peut-√™tre invalide');
                }
            };
            reader.readAsText(file);
            closeNewPartieModal(); // Fermer modal apr√®s load
            updateRoomInfo(); // Actualiser affichage
        });
        function openNewPartieModal() {
            overlay.style.display = 'block';
            modal.style.display = 'block';
            document.getElementById("cancel-abandon").style.display = 'block';
            document.getElementById("cancel-abandon").onclick = function () {
                closeNewPartieModal();
            }
        }
        function closeNewPartieModal() {
            overlay.style.display = 'none';
            modal.style.display = 'none';
            loadPlayerParams(); // Charger les params du joueur apr√®s fermeture modal
            //actualise tableau mj
            //updateCardPlayerButtons();
            updateCardPlayer();
            //applyPermissions();
            updateRoomInfo();   // Actualiser affichage

        }
        ////////New Partie//////////////////
        document.getElementById('start-game').addEventListener('click', () => {
            const players = [];

            document.querySelectorAll('[adn-player]').forEach(input => {
                const key = input.getAttribute('adn-player');
                const name = input.value || "";
                const isGpt = input.parentElement.querySelector('[adn-gpt]')?.checked;
                players.push({
                    key,
                    nom: name,
                    type: isGpt ? 'gpt' : 'Humain'
                });

                /*const key = input.dataset.player;
    const name = input.value || key;
    const isGpt = document.querySelector(`[adn-gpt]`).checked;*/
                //change partie.adn.lieu
                startAdn.lieu = document.querySelector('[adn-lieu]').value || "";
                //partie.adn.lieu = inputLieu;
                startAdn.sallePublic = document.querySelector('[adn-public]').value || "";
                /*     key,
                     nom: name,
                     lieu: place,
                     sallePublic: public,
                     type: isGpt ? 'gpt' : 'Humain'
                 });
              players: {
                 J1: { sallePerso: "", scene: "", nom: "", role: "", perso: "", vivant: true, type: "Humain" },
                 J2: { sallePerso: "", scene: "", nom: "", role: "", perso: "", vivant: true, type: "gpt" },
                 J3: { sallePerso: "", scene: "", nom: "", role: "", perso: "", vivant: true, type: "gpt" }
             }*/
            });

            startNewGame(players);
        });
        async function startNewGame(players) {
            const exAdn = partie.adn;

            const promptSystem = `ancien1adn: { lieu: "√âmission TV", sallePublic: "Pupitre du plateau", players: { J1: {sallePerso: 2, scene: "Epreuve de jeu", nom: "Matt", role: "Justicier", perso: "Animateur TV", vivant: true, type: "Humain" }, J2: { sallePerso: 3, scene: "Les loges", nom: "Robert", role: "Innocent", perso: "Candidat", vivant: true, type: "gpt" }, J3: { sallePerso: 1, scene: "Les coulisses", nom: "Michel", role: "Meurtrier", perso: "Producteur", vivant: true, type: "gpt" } }, currentSalle: "sallePublic", buzzActive: false } 
et ancien2adn: { lieu: "Le mariage de ma soeur", sallePublic: "Salle de repas", players: { J1: { sallePerso: 3, scene: "Piste de danse", nom: "Joey", role: "Justicier", perso: "Le mari√©", vivant: true, type: "Humain" }, J2: { sallePerso: 1, scene: "Pr√©paration de la mari√©e ", nom: "Lola", role: "Innocent", perso: "La mari√©e", vivant: true, type: "gpt" }, J3: { sallePerso: 2, scene: "Banc de l'√©glise", nom: "Aston", role: "Meurtrier", perso: "Le fr√®re", vivant: true, type: "gpt" } }, currentSalle: "sallePublic", buzzActive: false } 
//sallePerso : 1, 2 ou 3 (index au hasard) - role: Meurtrier, Justicier et Innocent (3 pers.=3 roles) - vivant = true 
Tu es le moteur du jeu Loup-Garou.
Tu re√ßois un √©tat de jeu en JSON.
Tu dois renvoyer UNIQUEMENT le NOUVEL √©tat du jeu.
‚ö†Ô∏è R√®gles imp√©ratives :
- R√©ponds uniquement avec du JSON valide
- Aucun texte hors JSON
- M√™me structure que l'entr√©e, en t'aidant des 2 anciens adn, mais nouveau sc√©nario
- La requ√™te est le minimum des consignes demand√© par l'utilisateur
- Il doit √™tre facile de prendre les sc√®nes en photo et de bien les diff√©rencier 
- Ne supprime aucune cl√©
`;

            // Config minimal ADN pour buildMinimalAdn
            startAdn.players = players;
            partie.adn = buildMinimalAdn(startAdn);
            console.log("adn= ", partie.adn/*, " player= ", player*/, " players= ", players, " startAdn= ", startAdn);
            //vers serveur node
            const dataToSend = {
                promptSystem: promptSystem,
                promptUser: JSON.stringify(partie.adn, null, 2)
            };
            console.log("dataSend: ", dataToSend, "Prompt : ", promptSystem, " Ask : ", JSON.stringify(partie.adn, null, 2));

            try {
                console.log("üöÄ FETCH VA √äTRE ENVOY√â");
                const response = await fetch("http://localhost:3000/chat", {
                    method: "POST",                  // ‚Üê c‚Äôest √ßa qui fait un POST
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(dataToSend) // ‚Üê ton objet transform√© en JSON
                });

                const result = await response.json();
                console.log("R√©ponse serveur :", result);
                const raw = result.answer;
                ;

                // si tu fais : res.json({ answer: response.output_text })
                const cleanAdn = cleanAndParseGPTAnswer({ answer: raw });

                partie.adn = cleanAdn;
                console.log("Adn g√©n√©r√© : ", partie.adn);

            } catch (err) {
                console.error("Erreur fetch :", err);
            }

            /*// üîπ Appel Edge Function pour g√©n√©rer le nouvel ADN
                        try {
                            const response = await fetch('https://cpktnkjahurhvhabwnsf.supabase.co/functions/v1/openai-completion', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    promptSystem: promptSystem,
                                    promptUser: partie.adn
                                })
                            });
            
                            if (!response.ok) throw new Error(`Erreur Edge Function: ${response.status}`);
            
                            const data = await response.json();
            
                            // Mettre √† jour partie.adn avec le nouvel ADN renvoy√©
                            partie.adn = JSON.parse(data.text);
            
                            // Reset de l'historique
                            partie.history = [];
            
                            console.log('Nouvelle partie d√©marr√©e avec ADN :', partie);
            
                        } catch (err) {
                            console.error('Erreur lors de l‚Äôappel Edge Function:', err);
                            // fallback : garder l'ancien ADN
                            partie.adn = exAdn;
                        }*/

            // Joueur local = premier humain
            const human = players.find(p => p.type === 'Humain');
            user1is = human?.key || 'J1';

            closeNewPartieModal(); // Fermer modal au lieu de start-overlay
            init(); // Ton init existant
        }

        function buildMinimalAdn(startAdn) {
            const j1 = startAdn.players.find(p => p.key === 'J1') || {};
            const j2 = startAdn.players.find(p => p.key === 'J2') || {};
            const j3 = startAdn.players.find(p => p.key === 'J3') || {};
            return {
                lieu: startAdn.lieu || "", // Si theme ajout√© plus tard
                sallePublic: startAdn.sallePublic,
                players: {
                    J1: {
                        sallePerso: "",
                        scene: "",
                        nom: j1.nom || "",
                        role: "",
                        perso: j1.perso || "",
                        vivant: true,
                        type: j1.type || "Humain"
                    },
                    J2: {
                        sallePerso: "",
                        scene: "",
                        nom: j2.nom || "",
                        role: "",
                        perso: j2.perso || "",
                        vivant: true,
                        type: j2.type || "gpt"
                    },
                    J3: {
                        sallePerso: "",
                        scene: "",
                        nom: j3.nom || "",
                        role: "",
                        perso: j3.perso || "",
                        vivant: true,
                        type: j3.type || "gpt"
                    }
                },
                currentSalle: "SallePublic",
                buzzActive: false
            };
        }
        function cleanAndParseGPTAnswer(gptResponse) {
            if (!gptResponse || typeof gptResponse.answer !== "string") {
                throw new Error("R√©ponse GPT invalide (answer manquant)");
            }

            let text = gptResponse.answer.trim();

            // 1Ô∏è‚É£ Supprimer les fences Markdown ```json ... ```
            text = text
                .replace(/^```json\s*/i, "")
                .replace(/^```\s*/i, "")
                .replace(/\s*```$/i, "");

            // 2Ô∏è‚É£ Extraire le JSON (au cas o√π GPT ajoute du texte)
            const match = text.match(/\{[\s\S]*\}/);
            if (!match) {
                throw new Error("Aucun JSON d√©tect√© dans la r√©ponse GPT");
            }

            // 3Ô∏è‚É£ Parser le JSON
            try {
                return JSON.parse(match[0]);
            } catch (e) {
                console.error("JSON brut re√ßu :", match[0]);
                throw new Error("JSON invalide retourn√© par GPT");
            }
        }
    </script>
    <style>
        #TBsave {
            display: flex;
            flex-direction: row;
        }

        #sidebar {
            position: fixed;
            left: 0;
            top: 0;
            background: var(--sidebar-bg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px var(--box-shadow-color);
            /*z-index: 10;*/
        }

        @media (min-width: 600px) {
            #sidebar {
                bottom: 0;
                width: 320px;
                gap: 20px;
                overflow-y: auto;
            }
        }

        @media (max-width: 600px) {
            #sidebar {
                display: block;
                grid-template-columns: 1fr 1fr 1fr;
                right: 0;
                height: 190px;
                gap: 5px;
                /*scroll-horizontal*/
                overflow-y: auto;
                /*white-space: nowrap;*/

            }

        }
    </style>
    <div id="sidebar">
        <h2>Tableau de bord</h2>
        <!--<div id="player-buttons">
            <button id="btn-j1">J1</button>
            <button id="btn-j2">J2</button>
            <button id="btn-j3">J3</button>
        </div>-->
        <style>
            #player-presentation {
                display: grid;
                grid-template-columns: 1fr 1fr;
                /*gap: 12px;*/
            }

            @media (min-width: 600px) {}
        </style>
        <div id="player-presentation"></div>
        <script>
            function renderPlayerPresentation() {
                // user1is = 'J1';
                const presentation = document.getElementById('player-presentation');

                const players = Object.entries(partie.adn.players)
                    .filter(([k, v]) => v.nom)
                    .map(([k, v], i) => `
      <p>
        <strong>J${i + 1} ‚Äì ${v.nom}</strong><br>
        ${v.perso}<br>
        ${v.type === 'gpt' ? 'ü§ñ IA' : 'üßë Humain'}<br>
        ${v.vivant ? 'ü´Ä Vivant' : '‚ò†Ô∏è Mort'}
      </p>
    `)
                    .join('');

                presentation.innerHTML = `<h3>Personnages</h3>${players}`;
            }
            function updateCardPlayer() {
                renderPlayerPresentation();

                const canEdit = mode === 'mj' || mode === 'joueur';

                playerParams.style.display = canEdit ? 'block' : 'none';

                if (canEdit) {
                    loadPlayerParams(user1is);
                }

                const title = document.getElementById('params-title');
                title.textContent =
                    mode === 'mj'
                        ? `Param√®tres ‚Äì ${user1is}`
                        : 'Mes param√®tres';
            }

        </script>
        <style>
            #player-params input,
            #player-params select {
                /*padding: 5px;*/
                background: var(--input-bg);
                color: var(--text-color);
                border: 1px solid var(--border-color);
                border-radius: 4px;

            }

            #player-params label {}

            @media (min-width: 600px) {
                #player-params label {
                    /*display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 12px;*/
                    display: block;
                    margin-bottom: 10px;
                }

                #player-params input,
                #player-params select {
                    width: 100%;
                }
            }

            @media (max-width: 600px) {
                #player-params label {
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr 1fr;
                }
            }
        </style>
        <div id="player-params">
            <div id="TBsave">
                <button id="save-params">Sauvegarder</button>
                <h3 id="params-title"></h3>
            </div>
            <label>Nom: <input type="text" id="param-name"></label>
            <label>Role: <input type="text" id="param-role" readonly></label>
            <label>Personnage: <input type="text" id="param-perso"></label>
            <label>Type:
                <select id="param-type">
                    <option value="Humain">Humain</option>
                    <option value="gpt">Gpt</option>
                </select>
            </label>
            <label>Sc√®ne: <input type="text" id="param-scene"></label>
            <label>Vivant: <input type="checkbox" id="param-vivant"></label>
        </div>
        <script>
            const playerParams = document.getElementById('player-params');
            const paramName = document.getElementById('param-name');
            const paramRole = document.getElementById('param-role');
            const paramPerso = document.getElementById('param-perso');
            const paramType = document.getElementById('param-type');
            const paramScene = document.getElementById('param-scene');
            const paramVivant = document.getElementById('param-vivant');
            const saveParams = document.getElementById('save-params');
            // Charger les params du joueur
            function loadPlayerParams(playerKey = user1is) {
                //charger les param√®tres de user1is
                const player = partie.adn.players[playerKey];
                if (!player) {
                    playerParams.style.display = 'none';
                    return;
                }
                playerParams.style.display = 'block';
                document.getElementById('params-title').textContent = `Mes param√®tres`;

                /*                const player = partie.adn.players[0];
                if (!player || typeof player !== 'object') return;
*/
                paramName.value = player.nom;
                paramRole.value = player.role;
                paramPerso.value = player.perso;
                paramType.value = player.type;
                paramScene.value = player.scene;
                paramVivant.checked = player.vivant;
            }
            // Sauvegarder les params
            saveParams.addEventListener('click', () => {
                const player = partie.adn.players[user1is];
                player.nom = paramName.value;
                player.perso = paramPerso.value;
                player.type = paramType.value;
                player.scene = paramScene.value;
                player.vivant = paramVivant.checked;
                // Mise √† jour des boutons si nom change
                /*const btnEl = document.getElementById(`btn-${ViewedPlayer.toLowerCase()}`);
                if (btnEl) btnEl.textContent = `Joueur ${ViewedPlayer.replace('J', '')} (#${player.nom})`;
*/
                // Enregistrer modification dans l'historique et mettre √† jour l'UI
                partie.history.push({
                    sender: 'System',
                    message: `‚úèÔ∏è ${partie.adn[user1is]?.nom ?? user1is} a modifi√© ses param√®tres.`,
                    target: null
                });
                updateCardPlayer();
                //showMessages();
            });
        </script>
    </div>
    <style>
        #main {
            margin-left: 340px;
            padding: 20px;
        }

        @media (max-width: 600px) {
            #main {
                margin-left: 0;
                margin-top: 210px;
                padding: 10px;
            }
        }
    </style>
    <div id="main">
        <h1>Tralala - Jeu Garou Mortel</h1>
        <div id="game-banner">
            <span id="game-status">üïØÔ∏è Le jeu est en cours</span>
            <button id="toggle-mj">Mode : Joueur</button>
            <div id="room-header">
                <div id="room-title"></div>
                <div id="room-dots">
                </div>
            </div>
            <div id="mj-panel" style="display:none;">
                <h3>üé≠ Mode Ma√Ætre du Jeu</h3>
                <textarea style="width: 300px;" id="adn-editor" rows="8"></textarea>
                <button id="apply-adn">Appliquer ADN</button>
                <button id="toggle-user">Vue : J1</button>
            </div>
        </div>
        <script>
            //////////// Btn MJ  ////////////////////////
            let mode = 'joueur'; // ou 'mj'
            const toggleMJBtn = document.getElementById('toggle-mj');
            const mjPanel = document.getElementById('mj-panel');
            const adnEditor = document.getElementById('adn-editor');
            toggleMJBtn.addEventListener('click', () => {
                if (mode === 'joueur') {
                    mode = 'mj';
                    toggleMJBtn.textContent = "Mode: MJ";
                    mjPanel.style.display = 'block';
                    adnEditor.value = JSON.stringify(partie.adn, null, 2);// Affiche ADN
                } else {
                    mode = 'joueur';
                    toggleMJBtn.textContent = "Mode: Joueur";
                    mjPanel.style.display = 'none';
                    //ViewedPlayer = 'J1';
                    loadPlayerParams();

                }
                //applyPermissions();
            });
            document.getElementById('apply-adn').addEventListener('click', () => {
                const origin = mode === 'mj' ? 'MJ' : /*ViewedPlayer*/console.log("Apply Viewed");
                applyAdnChange(origin);
            });
            function applyAdnChange(origin = 'MJ') {
                console.log("origin= ", origin);
                try {
                    const parsedAdn = JSON.parse(adnEditor.value);
                    partie.adn = parsedAdn;

                    partie.history.push({
                        sender: 'System',
                        message:
                            origin === 'MJ'
                                ? 'üîÑ L‚ÄôADN du sc√©nario a √©t√© modifi√© par le MJ.'
                                : `‚úèÔ∏è ${partie.adn[origin]?.nom ?? origin} a modifi√© ses param√®tres.`,
                        target: null
                    });
                    updateCardPlayer(); showMessages();
                    updateSalle(); // Ajout√© pour rafra√Æchir les dots apr√®s modification ADN
                } catch (e) {
                    //  alert("ADN invalide (JSON incorrect)");
                }
            }
        </script>
        <div id="room-info"></div>
        <!--A FAIRE : Mettre titre √† gauche et Bouton MJ/Joueur √† droite dans m√™me div-->

        <div id="display"></div>
        <div id="buzz-zone">
            <button id="buzz">BUZZ</button>
            <p id="buzz-info">Le buzz est inactif.</p>
            <button id="buzz-next">NEXT</button>
        </div>
        <div id="input-zone">
            <input type="text" id="message-input" placeholder="√âcris ton message...">
            <button id="send-btn">Envoyer</button>
        </div>
        <div>
        </div>
    </div>

    <footer>
        Jeu de r√¥le exp√©rimental par MattMarket Digitals.
        <button id="abandon-btn">Abandonner la partie</button>
        <button id="save-partie">üíæ Sauvegarder la partie</button>
    </footer>
    <script>
        /////////////////Sauvegarder////////////////////////
        document.getElementById('save-partie').addEventListener('click', () => {
            console.log("SAVE");
            const data = JSON.stringify(partie, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'partie.json';
            a.click();

            URL.revokeObjectURL(url);
        });
        // Objet Partie contenant ADN et historique
        let partie = {
            adn: {
                lieu: "√âmission TV ¬´ Tralala ¬ª",
                sallePublic: "Pupitre TV",
                players: {
                    J1: { sallePerso: 1, scene: "Epreuve", nom: "Toi", role: "Justicier", perso: "Animateur", vivant: true, type: "Humain" },
                    J2: { sallePerso: 2, scene: "Loge", nom: "Robert", role: "Acolyte", perso: "Candidat", vivant: true, type: "gpt" },
                    J3: { sallePerso: 3, scene: "Coulisses", nom: "Michel", role: "Meurtrier", perso: "Producteur", vivant: true, type: "gpt" }
                },
                currentSalle: "sallePublic",
                buzzActive: false
            },
            history: [] // {sender: 'salleKey', message: 'texte', target: 'salleKey'}
        };

        document.getElementById('abandon-btn').addEventListener('click', //async () => { await abandonnerPartie(partie.adn.J1.nom); }
            () => openNewPartieModal());
        // Initialisation
        function init() {
            const welcome = "üé¨ Bienvenue dans Tralala. Tu es l‚ÄôAnimateur (Justicier). S√©lectionne une salle ou reste en public.";
            partie.history.push({ sender: 'System', message: welcome, target: null });
            //   showMessages();
            loadPlayerParams();
            // updateCardPlayerButtons();
            updateCardPlayer();
            //applyPermissions();
            //updateRoomInfo();
            //updateSalle(); // Ajout√© pour g√©n√©rer les dots au d√©marrage
            //setTimeout(activateBuzz, 5000);
        }
    </script>

</body>

</html>